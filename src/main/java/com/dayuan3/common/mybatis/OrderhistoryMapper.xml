<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dayuan3.common.mapper.OrderhistoryMapper">
  <resultMap id="BaseResultMap" type="com.dayuan3.common.bean.Orderhistory">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Jul 18 14:16:23 CST 2019.
    -->
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="user_type" jdbcType="SMALLINT" property="userType" />
    <result column="keyword" jdbcType="VARCHAR" property="keyword" />
    <result column="key_id" jdbcType="INTEGER" property="keyId" />
    <result column="key_type" jdbcType="SMALLINT" property="keyType" />
    <result column="type" jdbcType="SMALLINT" property="type" />
    <result column="history_count" jdbcType="INTEGER" property="historyCount" />
    <result column="create_by" jdbcType="INTEGER" property="createBy" />
    <result column="create_date" jdbcType="TIMESTAMP" property="createDate" />
    <result column="update_by" jdbcType="INTEGER" property="updateBy" />
    <result column="update_date" jdbcType="TIMESTAMP" property="updateDate" />
    <result column="delete_flag" jdbcType="SMALLINT" property="deleteFlag" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Jul 18 14:16:23 CST 2019.
    -->
    id, user_type, keyword, key_id, key_type, type, history_count, create_by, create_date,
    update_by, update_date, delete_flag
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Jul 18 14:16:23 CST 2019.
    -->
    select
    <include refid="Base_Column_List" />
    from order_history
    where id = #{id,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Jul 18 14:16:23 CST 2019.
    -->
    delete from order_history
    where id = #{id,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.dayuan3.common.bean.Orderhistory">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Jul 18 14:16:23 CST 2019.
    -->
    insert into order_history (id, user_type, keyword,
      key_id, key_type, type,
      history_count, create_by, create_date,
      update_by, update_date, delete_flag
      )
    values (#{id,jdbcType=INTEGER}, #{userType,jdbcType=SMALLINT}, #{keyword,jdbcType=VARCHAR},
      #{keyId,jdbcType=INTEGER}, #{keyType,jdbcType=SMALLINT}, #{type,jdbcType=SMALLINT},
      #{historyCount,jdbcType=INTEGER}, #{createBy,jdbcType=INTEGER}, #{createDate,jdbcType=TIMESTAMP},
      #{updateBy,jdbcType=INTEGER}, #{updateDate,jdbcType=TIMESTAMP}, #{deleteFlag,jdbcType=SMALLINT}
      )
  </insert>
  <insert id="insertSelective" parameterType="com.dayuan3.common.bean.Orderhistory">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Jul 18 14:16:23 CST 2019.
    -->
    insert into order_history
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="id != null">
        id,
      </if>
      <if test="userType != null">
        user_type,
      </if>
      <if test="keyword != null">
        keyword,
      </if>
      <if test="keyId != null">
        key_id,
      </if>
      <if test="keyType != null">
        key_type,
      </if>
      <if test="type != null">
        type,
      </if>
      <if test="historyCount != null">
        history_count,
      </if>
      <if test="createBy != null">
        create_by,
      </if>
      <if test="createDate != null">
        create_date,
      </if>
      <if test="updateBy != null">
        update_by,
      </if>
      <if test="updateDate != null">
        update_date,
      </if>
      <if test="deleteFlag != null">
        delete_flag,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="id != null">
        #{id,jdbcType=INTEGER},
      </if>
      <if test="userType != null">
        #{userType,jdbcType=SMALLINT},
      </if>
      <if test="keyword != null">
        #{keyword,jdbcType=VARCHAR},
      </if>
      <if test="keyId != null">
        #{keyId,jdbcType=INTEGER},
      </if>
      <if test="keyType != null">
        #{keyType,jdbcType=SMALLINT},
      </if>
      <if test="type != null">
        #{type,jdbcType=SMALLINT},
      </if>
      <if test="historyCount != null">
        #{historyCount,jdbcType=INTEGER},
      </if>
      <if test="createBy != null">
        #{createBy,jdbcType=INTEGER},
      </if>
      <if test="createDate != null">
        #{createDate,jdbcType=TIMESTAMP},
      </if>
      <if test="updateBy != null">
        #{updateBy,jdbcType=INTEGER},
      </if>
      <if test="updateDate != null">
        #{updateDate,jdbcType=TIMESTAMP},
      </if>
      <if test="deleteFlag != null">
        #{deleteFlag,jdbcType=SMALLINT},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.dayuan3.common.bean.Orderhistory">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Jul 18 14:16:23 CST 2019.
    -->
    update order_history
    <set>
      <if test="userType != null">
        user_type = #{userType,jdbcType=SMALLINT},
      </if>
      <if test="keyword != null">
        keyword = #{keyword,jdbcType=VARCHAR},
      </if>
      <if test="keyId != null">
        key_id = #{keyId,jdbcType=INTEGER},
      </if>
      <if test="keyType != null">
        key_type = #{keyType,jdbcType=SMALLINT},
      </if>
      <if test="type != null">
        type = #{type,jdbcType=SMALLINT},
      </if>
      <if test="historyCount != null">
        history_count = #{historyCount,jdbcType=INTEGER},
      </if>
      <if test="createBy != null">
        create_by = #{createBy,jdbcType=INTEGER},
      </if>
      <if test="createDate != null">
        create_date = #{createDate,jdbcType=TIMESTAMP},
      </if>
      <if test="updateBy != null">
        update_by = #{updateBy,jdbcType=INTEGER},
      </if>
      <if test="updateDate != null">
        update_date = #{updateDate,jdbcType=TIMESTAMP},
      </if>
      <if test="deleteFlag != null">
        delete_flag = #{deleteFlag,jdbcType=SMALLINT},
      </if>
    </set>
    where id = #{id,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.dayuan3.common.bean.Orderhistory">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Jul 18 14:16:23 CST 2019.
    -->
    update order_history
    set user_type = #{userType,jdbcType=SMALLINT},
      keyword = #{keyword,jdbcType=VARCHAR},
      key_id = #{keyId,jdbcType=INTEGER},
      key_type = #{keyType,jdbcType=SMALLINT},
      type = #{type,jdbcType=SMALLINT},
      history_count = #{historyCount,jdbcType=INTEGER},
      create_by = #{createBy,jdbcType=INTEGER},
      create_date = #{createDate,jdbcType=TIMESTAMP},
      update_by = #{updateBy,jdbcType=INTEGER},
      update_date = #{updateDate,jdbcType=TIMESTAMP},
      delete_flag = #{deleteFlag,jdbcType=SMALLINT}
    where id = #{id,jdbcType=INTEGER}
  </update>
    <update id="updateHistory">
        update order_history
        set
            key_id = #{keyId,jdbcType=INTEGER},
            update_date = #{updateDate,jdbcType=TIMESTAMP}
        where id = #{id,jdbcType=INTEGER}
    </update>


    <!--判断keyid 是否存在  -->
    <select id="selectByKeyId" parameterType="Object" resultMap="BaseResultMap">
 	SELECT * from order_history WHERE
 	delete_flag=0 AND type=0
 	 AND create_by=#{createBy} AND key_type=#{keyType} AND key_id=#{keyId} ORDER BY history_count DESC LIMIT 0,1
  </select>



  <!-- 委托单位历史数据 -->
    <resultMap id="UnitBaseResultMap" type="com.dayuan3.terminal.bean.RequesterUnit">
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="departId" jdbcType="INTEGER" property="departId" />
    <result column="regNumber" jdbcType="VARCHAR" property="regNumber" />
    <result column="requesterName" jdbcType="VARCHAR" property="requesterName" />
    <result column="requesterOtherName" jdbcType="VARCHAR" property="requesterOtherName" />
    <result column="unitType" jdbcType="INTEGER" property="unitType" />
    <result column="legalPerson" jdbcType="VARCHAR" property="legalPerson" />
    <result column="legalPhone" jdbcType="VARCHAR" property="legalPhone" />
    <result column="linkUser" jdbcType="VARCHAR" property="linkUser" />
    <result column="linkPhone" jdbcType="VARCHAR" property="linkPhone" />
     <result column="companyAddress" jdbcType="VARCHAR" property="companyAddress" />
  </resultMap>

  <!--查询委托单位历史  -->
    <select id="selectUnitHistory" parameterType="Object" resultMap="UnitBaseResultMap">
	SELECT
	u.id as id,u.requester_name as requesterName,u.requester_other_name as requesterOtherName,u.link_phone as linkPhone,u.company_address as companyAddress
	FROM
		order_history h LEFT JOIN requester_unit u ON h.key_id=u.id
	WHERE
		h.delete_flag = 0 AND u.delete_flag=0
	AND h.type = 0
	AND h.key_type = 0
	AND h.create_by = #{createBy}
	ORDER BY
		h.history_count DESC,h.update_date DESC


  </select>



    <resultMap id="FoodBaseResultMap" type="com.dayuan3.common.bean.baseFood" >
    <id column="id" property="id"/>
    <result column="foodName" property="foodName" jdbcType="VARCHAR" />
    <result column="foodNameEn" property="foodNameEn" jdbcType="VARCHAR" />
    <result column="foodNameOther" property="foodNameOther" jdbcType="VARCHAR" />
    <result column="isFood" property="isFood"  jdbcType="SMALLINT"/>
  </resultMap>

  <!--查询委托单位历史  -->
    <select id="selectFoodHistory" parameterType="Object" resultMap="FoodBaseResultMap">
	SELECT
	f.id as id,f.food_name as foodName,f.food_name_en as foodNameEn,f.food_name_other as foodNameOther,f.isFood as isFood
	FROM
		order_history h LEFT JOIN base_food_type f ON h.key_id=f.id
	WHERE
		h.delete_flag = 0 AND f.delete_flag=0 AND f.isFood=1
	AND h.type = 0
	AND h.key_type = 1
	AND h.create_by = #{createBy}
	ORDER BY
		h.history_count DESC,h.update_date DESC

  </select>

    <!--根据openid和类型查询搜索的历史记录 shit-->
    <select id="selectHisrotyByOpenid" resultType="com.dayuan3.common.bean.Orderhistory">
      SELECT id,keyword,key_id AS keyId,key_type AS keyType FROM order_history WHERE keyword = #{openid} AND key_type = #{type} AND delete_flag = 0
    </select>


    <!-- 批量插入 暂时无用 -->
    <insert id="insertList" parameterType="java.util.List">
    insert into data_item (  id, user_type, keyword, key_id, key_type, type, history_count, create_by, create_date,
    update_by, update_date, delete_flag)
    values
     <foreach collection="list" item="item" index="index" separator=",">
      (#{item.id,jdbcType=INTEGER}, #{item.userType,jdbcType=SMALLINT}, #{item.keyword,jdbcType=VARCHAR},#{item.keyId,jdbcType=INTEGER},
      #{item.keyType,jdbcType=SMALLINT}, #{item.type,jdbcType=SMALLINT}, #{item.historyCount,jdbcType=INTEGER},
      #{item.createBy,jdbcType=INTEGER}, #{item.create_date,jdbcType=TIMESTAMP}, #{item.update_by,jdbcType=INTEGER},
      #{item.update_date,jdbcType=TIMESTAMP}, #{item.delete_flag,jdbcType=SMALLINT})
    </foreach>
  </insert>
    <insert id="insertHistory">
        insert into order_history (id, keyword,key_id, key_type,create_date,update_date
        )
        values (#{id,jdbcType=INTEGER}, #{keyword,jdbcType=VARCHAR},#{keyId,jdbcType=INTEGER}, #{keyType,jdbcType=SMALLINT},
                 #{createDate,jdbcType=TIMESTAMP},#{updateDate,jdbcType=TIMESTAMP}
        )
    </insert>

</mapper>