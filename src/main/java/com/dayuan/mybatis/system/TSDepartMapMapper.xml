<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dayuan.mapper.system.TSDepartMapMapper">
  <resultMap id="BaseResultMap" type="com.dayuan.bean.system.TSDepartMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Sep 20 10:18:06 CST 2018.
    -->
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="depart_id" jdbcType="INTEGER" property="departId" />
    <result column="longitude" jdbcType="VARCHAR" property="longitude" />
    <result column="latitude" jdbcType="VARCHAR" property="latitude" />
    <result column="isShow" jdbcType="SMALLINT" property="isshow" />
    <result column="delete_flag" jdbcType="SMALLINT" property="deleteFlag" />
    <result column="create_by" jdbcType="VARCHAR" property="createBy" />
    <result column="create_date" jdbcType="TIMESTAMP" property="createDate" />
    <result column="update_by" jdbcType="VARCHAR" property="updateBy" />
    <result column="update_date" jdbcType="TIMESTAMP" property="updateDate" />
    <result column="param1" jdbcType="VARCHAR" property="param1" />
    <result column="param2" jdbcType="VARCHAR" property="param2" />
    <result column="param3" jdbcType="VARCHAR" property="param3" />
    <!-- 附加字段 -->
      <result column="depart_name" jdbcType="VARCHAR" property="departName" />
      <result column="address" jdbcType="VARCHAR" property="address" />
      <result column="depart_code" jdbcType="VARCHAR" property="departCode" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Sep 20 10:18:06 CST 2018.
    -->
    id, depart_id, longitude, latitude, isShow, delete_flag, create_by, create_date, 
    update_by, update_date, param1, param2, param3
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Sep 20 10:18:06 CST 2018.
    -->
    select 
    <include refid="Base_Column_List" />
    from t_s_depart_map
    where id = #{id,jdbcType=INTEGER}
  </select>
  <!-- 通过机构id查询 -->
    <select id="selectByDepartid" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    select 
    <include refid="Base_Column_List" />
    from t_s_depart_map
    where depart_id = #{departId,jdbcType=INTEGER}
  </select>
  
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Sep 20 10:18:06 CST 2018.
    -->
    delete from t_s_depart_map
    where id = #{id,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.dayuan.bean.system.TSDepartMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Sep 20 10:18:06 CST 2018.
    -->
    insert into t_s_depart_map (id, depart_id, longitude, 
      latitude, isShow, delete_flag, 
      create_by, create_date, update_by, 
      update_date, param1, param2, 
      param3)
    values (#{id,jdbcType=INTEGER}, #{departId,jdbcType=INTEGER}, #{longitude,jdbcType=VARCHAR}, 
      #{latitude,jdbcType=VARCHAR}, #{isshow,jdbcType=SMALLINT}, #{deleteFlag,jdbcType=SMALLINT}, 
      #{createBy,jdbcType=VARCHAR}, #{createDate,jdbcType=TIMESTAMP}, #{updateBy,jdbcType=VARCHAR}, 
      #{updateDate,jdbcType=TIMESTAMP}, #{param1,jdbcType=VARCHAR}, #{param2,jdbcType=VARCHAR}, 
      #{param3,jdbcType=VARCHAR})
  </insert>
  <insert id="insertSelective" parameterType="com.dayuan.bean.system.TSDepartMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Sep 20 10:18:06 CST 2018.
    -->
    insert into t_s_depart_map
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="id != null">
        id,
      </if>
      <if test="departId != null">
        depart_id,
      </if>
      <if test="longitude != null">
        longitude,
      </if>
      <if test="latitude != null">
        latitude,
      </if>
      <if test="isshow != null">
        isShow,
      </if>
      <if test="deleteFlag != null">
        delete_flag,
      </if>
      <if test="createBy != null">
        create_by,
      </if>
      <if test="createDate != null">
        create_date,
      </if>
      <if test="updateBy != null">
        update_by,
      </if>
      <if test="updateDate != null">
        update_date,
      </if>
      <if test="param1 != null">
        param1,
      </if>
      <if test="param2 != null">
        param2,
      </if>
      <if test="param3 != null">
        param3,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="id != null">
        #{id,jdbcType=INTEGER},
      </if>
      <if test="departId != null">
        #{departId,jdbcType=INTEGER},
      </if>
      <if test="longitude != null">
        #{longitude,jdbcType=VARCHAR},
      </if>
      <if test="latitude != null">
        #{latitude,jdbcType=VARCHAR},
      </if>
      <if test="isshow != null">
        #{isshow,jdbcType=SMALLINT},
      </if>
      <if test="deleteFlag != null">
        #{deleteFlag,jdbcType=SMALLINT},
      </if>
      <if test="createBy != null">
        #{createBy,jdbcType=VARCHAR},
      </if>
      <if test="createDate != null">
        #{createDate,jdbcType=TIMESTAMP},
      </if>
      <if test="updateBy != null">
        #{updateBy,jdbcType=VARCHAR},
      </if>
      <if test="updateDate != null">
        #{updateDate,jdbcType=TIMESTAMP},
      </if>
      <if test="param1 != null">
        #{param1,jdbcType=VARCHAR},
      </if>
      <if test="param2 != null">
        #{param2,jdbcType=VARCHAR},
      </if>
      <if test="param3 != null">
        #{param3,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.dayuan.bean.system.TSDepartMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Sep 20 10:18:06 CST 2018.
    -->
    update t_s_depart_map
    <set>
      <if test="departId != null">
        depart_id = #{departId,jdbcType=INTEGER},
      </if>
      <if test="longitude != null">
        longitude = #{longitude,jdbcType=VARCHAR},
      </if>
      <if test="latitude != null">
        latitude = #{latitude,jdbcType=VARCHAR},
      </if>
      <if test="isshow != null">
        isShow = #{isshow,jdbcType=SMALLINT},
      </if>
      <if test="deleteFlag != null">
        delete_flag = #{deleteFlag,jdbcType=SMALLINT},
      </if>
      <if test="createBy != null">
        create_by = #{createBy,jdbcType=VARCHAR},
      </if>
      <if test="createDate != null">
        create_date = #{createDate,jdbcType=TIMESTAMP},
      </if>
      <if test="updateBy != null">
        update_by = #{updateBy,jdbcType=VARCHAR},
      </if>
      <if test="updateDate != null">
        update_date = #{updateDate,jdbcType=TIMESTAMP},
      </if>
      <if test="param1 != null">
        param1 = #{param1,jdbcType=VARCHAR},
      </if>
      <if test="param2 != null">
        param2 = #{param2,jdbcType=VARCHAR},
      </if>
      <if test="param3 != null">
        param3 = #{param3,jdbcType=VARCHAR},
      </if>
    </set>
    where id = #{id,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.dayuan.bean.system.TSDepartMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Sep 20 10:18:06 CST 2018.
    -->
    update t_s_depart_map
    set depart_id = #{departId,jdbcType=INTEGER},
      longitude = #{longitude,jdbcType=VARCHAR},
      latitude = #{latitude,jdbcType=VARCHAR},
      isShow = #{isshow,jdbcType=SMALLINT},
      delete_flag = #{deleteFlag,jdbcType=SMALLINT},
      create_by = #{createBy,jdbcType=VARCHAR},
      create_date = #{createDate,jdbcType=TIMESTAMP},
      update_by = #{updateBy,jdbcType=VARCHAR},
      update_date = #{updateDate,jdbcType=TIMESTAMP},
      param1 = #{param1,jdbcType=VARCHAR},
      param2 = #{param2,jdbcType=VARCHAR},
      param3 = #{param3,jdbcType=VARCHAR}
    where id = #{id,jdbcType=INTEGER}
  </update>
  <!-- 根据dipartId修改内容 -->
  <update id="updateByDepartId" parameterType="com.dayuan.bean.system.TSDepartMap">
    update t_s_depart_map
    <set>
      <if test="id != null">
      id = #{id,jdbcType=INTEGER},
      </if>
      <if test="longitude != null">
        longitude = #{longitude,jdbcType=VARCHAR},
      </if>
      <if test="latitude != null">
        latitude = #{latitude,jdbcType=VARCHAR},
      </if>
      <if test="isshow != null">
        isShow = #{isshow,jdbcType=SMALLINT},
      </if>
      <if test="deleteFlag != null">
        delete_flag = #{deleteFlag,jdbcType=SMALLINT},
      </if>
      <if test="createBy != null">
        create_by = #{createBy,jdbcType=VARCHAR},
      </if>
      <if test="createDate != null">
        create_date = #{createDate,jdbcType=TIMESTAMP},
      </if>
      <if test="updateBy != null">
        update_by = #{updateBy,jdbcType=VARCHAR},
      </if>
      <if test="updateDate != null">
        update_date = #{updateDate,jdbcType=TIMESTAMP},
      </if>
      <if test="param1 != null">
        param1 = #{param1,jdbcType=VARCHAR},
      </if>
      <if test="param2 != null">
        param2 = #{param2,jdbcType=VARCHAR},
      </if>
      <if test="param3 != null">
        param3 = #{param3,jdbcType=VARCHAR},
      </if>
    </set>
    where depart_id = #{departId,jdbcType=INTEGER}
  </update>
  
  
  
  <!-- 项目预览功能  -->
  <resultMap id="BaseResultMapModel" type="com.dayuan.model.system.TSDepartMapModel">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Sep 20 10:18:06 CST 2018.
    -->
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="departId" jdbcType="INTEGER" property="departId" />
    <result column="departPid" jdbcType="INTEGER" property="departPid" />
    <result column="departName" jdbcType="VARCHAR" property="departName" />
    <result column="departCode" jdbcType="VARCHAR" property="departCode" />
    <result column="departCount" jdbcType="VARCHAR" property="departCount" />
    <result column="pointCount" jdbcType="VARCHAR" property="pointCount" />
    <result column="regCount" jdbcType="VARCHAR" property="regCount" />
  </resultMap>
  
  <!-- 通过机构id查询下级机构、检测点 监管对象数量 -->
    <select id="selectReportByDepartid" parameterType="java.lang.Integer" resultMap="BaseResultMapModel">
    SELECT
		id as departId,depart_pid as departPid,
		depart_name as departName,
		depart_code as departCode,
		( SELECT COUNT(1) FROM t_s_depart de LEFT JOIN t_s_depart_map map on de.id=map.depart_id WHERE de.delete_flag = 0 AND de.depart_pid = depart.id and map.isShow=0 AND map.longitude!='' ) AS departCount,
		(SELECT COUNT(1) from base_point p LEFT JOIN t_s_depart d1 on p.depart_id = d1.id WHERE p.place_x is NOT NULL and p.place_y IS NOT NULL and p.place_x!=''and p.place_y!='' AND  p.delete_flag=0 AND  d1.depart_code LIKE CONCAT(depart.depart_code,'%')) pointCount,
		(SELECT COUNT(1) from base_regulatory_object obj LEFT JOIN t_s_depart d2 on obj.depart_id=d2.id
		WHERE obj.delete_flag=0 AND obj.checked=1 and obj.place_x is NOT NULL and obj.place_y IS NOT NULL and obj.place_x!=''and obj.place_y!='' AND d2.depart_code LIKE CONCAT(depart.depart_code,'%')) as regCount
	FROM
	t_s_depart depart
	WHERE
 	depart.delete_flag=0 AND	depart.id = #{departId}
  </select>
  
  <!-- 通过机构id查询下级机构和当前id机构定位信息 -->
    <select id="selectDepartByDepartid" parameterType="Object" resultMap="BaseResultMap">
   	SELECT d.id AS depart_id, d.depart_name,map.longitude,map.latitude,d.depart_code,d.address
 	from t_s_depart d LEFT JOIN t_s_depart_map map ON d.id=map.depart_id
	WHERE d.delete_flag=0 
	and map.isShow=0
	and (d.depart_pid=#{departId} OR d.id=#{departId})
	<if test="departName != null">
	and d.depart_name LIKE CONCAT('%',#{departName},'%')
	</if>
  </select>
  
  <!-- 查询信息列表 -->
	<select id="loadDatagrid" resultMap="BaseResultMap"
		parameterType="Object">
			SELECT d.id AS depart_id, d.depart_name,map.longitude,map.latitude,d.depart_code,d.address
		 	from t_s_depart d LEFT JOIN t_s_depart_map map ON d.id=map.depart_id
			WHERE d.delete_flag=0 
			and map.isShow=0
			and (d.depart_pid=#{obj.departId} )<!-- delete by xiaoyl 2020/06/09 项目预览中修改  OR d.id=#{obj.departId} -->
			<if test="obj.departName != null">
			and d.depart_name LIKE CONCAT('%',#{obj.departName},'%')
			</if>
	 	limit #{rowOffset}, #{pageSize}
	</select>
	<!-- 查询数据数量 -->
	<select id="getRowTotal" resultType="java.lang.Integer"
		parameterType="Object">
			select count(1) as rowTotal
			FROM
			t_s_depart d LEFT JOIN t_s_depart_map map ON d.id=map.depart_id
			WHERE d.delete_flag=0 
			and map.isShow=0
            and (d.depart_pid=#{obj.departId} )
			<if test="obj.departName != null">
			and d.depart_name LIKE CONCAT('%',#{obj.departName},'%')
			</if>
	</select>
  
  
  
</mapper>