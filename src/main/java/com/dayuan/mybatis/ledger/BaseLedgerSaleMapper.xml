<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dayuan.mapper.ledger.BaseLedgerSaleMapper">
	<resultMap id="BaseResultMap" type="com.dayuan.bean.ledger.BaseLedgerSale">
		<!-- WARNING - @mbg.generated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Tue May 08 
			13:11:49 CST 2018. -->
		<id column="id" jdbcType="INTEGER" property="id" />
		<result column="businessName" jdbcType="VARCHAR" property="businessName" />
		<result column="businessId" jdbcType="INTEGER" property="businessId" />
		<result column="regName" jdbcType="VARCHAR" property="regName" />
		<result column="regId" jdbcType="INTEGER" property="regId" />
		<result column="foodName" jdbcType="VARCHAR" property="foodName" />
		<result column="saleDate" jdbcType="TIMESTAMP" property="saleDate" />
		<result column="size" jdbcType="VARCHAR" property="size" />
		<result column="saleCount" jdbcType="VARCHAR" property="saleCount" />
		<result column="customerId" jdbcType="VARCHAR" property="customerId" />
		<result column="cusRegName" jdbcType="VARCHAR" property="cusRegName" />
		<result column="cusPhone" jdbcType="VARCHAR" property="cusPhone" />
		<result column="cusName" jdbcType="VARCHAR" property="cusName" />
		<result column="cusCode" jdbcType="VARCHAR" property="cusCode" />
		<result column="customer" jdbcType="VARCHAR" property="customer" />
		<result column="memo" jdbcType="VARCHAR" property="memo" />
		<result column="delete_flag" jdbcType="SMALLINT" property="delete_flag" />
		<result column="create_by" jdbcType="VARCHAR" property="create_by" />
		<result column="create_date" jdbcType="TIMESTAMP" property="create_date" />
		<result column="update_by" jdbcType="VARCHAR" property="update_by" />
		<result column="update_date" jdbcType="TIMESTAMP" property="update_date" />
		<result column="param1" jdbcType="VARCHAR" property="param1" />
		<result column="param2" jdbcType="VARCHAR" property="param2" />
		<result column="param3" jdbcType="VARCHAR" property="param3" />
		<result column="opeShopCode" jdbcType="VARCHAR" property="opeShopCode" />
		<result column="reg_name" jdbcType="VARCHAR" property="reg_name" />
	</resultMap>
	<sql id="Base_Column_List">
		<!-- WARNING - @mbg.generated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Tue May 08 
			13:11:49 CST 2018. -->
		id, businessName, businessId, regName, regId, foodName, saleDate,
		size, saleCount,
		customerId, cusRegName, cusPhone, cusName, cusCode, customer, memo, delete_flag,
		create_by, create_date, update_by, update_date, param1, param2, param3
	</sql>




	<!-- 查询条件 -->
	<sql id="check_Where_Clause">
		where 1=1
		and sale.delete_flag=0
		<if test="obj != null">
			<if test="obj.search !=null and obj.search !=''">
				and (sale.foodName like CONCAT('%', #{obj.search}, '%')
				or sale.customer like CONCAT('%', #{obj.search}, '%')
				)
			</if>
			<if test="obj.foodName !=null and obj.foodName !=''">
				and sale.foodName like CONCAT('%', #{obj.foodName}, '%')
			</if>
			<if test="obj.businessId !=null and obj.businessId !=''">
				and sale.businessId=#{obj.businessId}
			</if>
			<if test="obj.regId !=null and obj.regId !=''">
				and sale.regId=#{obj.regId}
			</if>
				<if test="obj.regtype !=null and obj.regtype !=''">
				and obj.reg_type=#{obj.regtype}
			</if>
			<if test="obj.departId !=null and obj.departId !=''">
				AND obj.depart_id in ( SELECT t.id FROM t_s_depart t WHERE t.delete_flag=0 AND t.depart_code LIKE CONCAT((SELECT s.depart_code FROM t_s_depart s WHERE s.id=#{obj.departId}),'%'))
			</if>
			<if test="obj.startDate !=null and obj.startDate !=''">
				and sale.saleDate like concat(#{obj.startDate},'%')
			</if><if test="obj.reg_name !=null and obj.reg_name !=''">
				and obj.reg_name like concat('%',#{obj.reg_name},'%')
			</if>
			<if test="obj.opeShopCode !=null and obj.opeShopCode !=''">
				and busi.ope_shop_code like concat('%',#{obj.opeShopCode},'%')
			</if>
			<if test="obj.cusRegName !=null and obj.cusRegName !=''">
				and sale.cusRegName like concat('%',#{obj.cusRegName},'%')
			</if>
				<if test="obj.saleDateStartDate!=null and obj.saleDateStartDate!=''">
			and sale.saleDate &gt;= #{obj.saleDateStartDate}
		</if>
		<if test="obj.saleDateEndDate and obj.saleDateEndDate!=''">
			and sale.saleDate &lt;= #{obj.saleDateEndDate}
		</if>
		</if>
	</sql>
	<!-- 查询信息列表 -->
	<select id="loadDatagrid" resultMap="BaseResultMap"
		parameterType="Object">
		select busi.ope_shop_code as opeShopCode,obj.reg_name as reg_name,sale.*
		from base_ledger_sale sale  
		LEFT JOIN base_regulatory_business busi on busi.id=sale.businessId
		LEFT JOIN base_regulatory_object obj on obj.id=sale.regId
		<include refid="check_Where_Clause" />
		order by sale.saleDate ${order}, sale.create_date  desc limit #{rowOffset}, #{pageSize}
	</select>
	<!-- 查询数据数量 -->
	<select id="getRowTotal" resultType="java.lang.Integer"
		parameterType="Object">
		select count(1) as rowTotal
		from base_ledger_sale sale  
		LEFT JOIN base_regulatory_business busi on busi.id=sale.businessId
		LEFT JOIN base_regulatory_object obj on obj.id=sale.regId
		<include refid="check_Where_Clause" />
	</select>

<!-- 批量删除-逻辑删除 -->
<update id="deleteByPrimaryKey" parameterType="Object" >
    update base_ledger_sale
    set delete_flag = 1
    where id in
    <foreach collection="array" item="ids" index="index" open="(" close=")" separator=",">
		#{ids}
    </foreach>
  </update>

	<select id="selectByPrimaryKey" parameterType="java.lang.Integer"
		resultMap="BaseResultMap">
		<!-- WARNING - @mbg.generated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Tue May 08 
			13:11:49 CST 2018. -->
		select
		<include refid="Base_Column_List" />
		from base_ledger_sale
		where id = #{id,jdbcType=INTEGER}
	</select>
	
	
	
	<resultMap id="BaseResultMapModel" type="com.dayuan.model.ledger.BaseLedgerSaleModel">
		<id column="id" jdbcType="INTEGER" property="id" />
		<result column="businessName" jdbcType="VARCHAR" property="businessName" />
		<result column="businessId" jdbcType="INTEGER" property="businessId" />
		<result column="regName" jdbcType="VARCHAR" property="regName" />
		<result column="regId" jdbcType="INTEGER" property="regId" />
		<result column="foodName" jdbcType="VARCHAR" property="foodName" />
		<result column="saleDate" jdbcType="TIMESTAMP" property="saleDate" />
		<result column="size" jdbcType="VARCHAR" property="size" />
		<result column="saleCount" jdbcType="VARCHAR" property="saleCount" />
		<result column="customerId" jdbcType="VARCHAR" property="customerId" />
		<result column="cusRegName" jdbcType="VARCHAR" property="cusRegName" />
		<result column="cusPhone" jdbcType="VARCHAR" property="cusPhone" />
		<result column="cusName" jdbcType="VARCHAR" property="cusName" />
		<result column="cusCode" jdbcType="VARCHAR" property="cusCode" />
		<result column="customer" jdbcType="VARCHAR" property="customer" />
		<result column="memo" jdbcType="VARCHAR" property="memo" />
		<result column="delete_flag" jdbcType="SMALLINT" property="delete_flag" />
		<result column="create_by" jdbcType="VARCHAR" property="create_by" />
		<result column="create_date" jdbcType="TIMESTAMP" property="create_date" />
		<result column="update_by" jdbcType="VARCHAR" property="update_by" />
		<result column="update_date" jdbcType="TIMESTAMP" property="update_date" />
		<result column="param1" jdbcType="VARCHAR" property="param1" />
		<result column="param2" jdbcType="VARCHAR" property="param2" />
		<result column="param3" jdbcType="VARCHAR" property="param3" />
		<result column="allCount" jdbcType="VARCHAR" property="allCount" />
		<result column="reg_id" jdbcType="VARCHAR" property="reg_id" />
		<result column="yiwanc" jdbcType="VARCHAR" property="yiwanc" />
		<result column="reg_name" jdbcType="VARCHAR" property="reg_name" />
	</resultMap>
	<!-- 查询信息列表 -->
	<select id="loadRegReport" resultMap="BaseResultMapModel"
		parameterType="Object">
		SELECT t.id as reg_id,t.reg_name,
		(SELECT COUNT(1) FROM base_regulatory_business b WHERE b.reg_id= t.id and b.delete_flag=0) as  allCount,
		SUM(CASE WHEN t.delete_flag=0 AND taiCount > 0 THEN 1 ELSE 0 END) yiwanc,
		SUM(CASE WHEN t.delete_flag=0 AND taiCount = 0 THEN 1 ELSE 0 END) weiwanc
		FROM (
		SELECT obj.id,obj.reg_name, b.id businessId,b.ope_name,b.delete_flag,
			(SELECT COUNT(1) FROM base_ledger_sale s WHERE s.businessId = b.id AND s.delete_flag = 0
		<if
			test="type!=null and type!='' and type=='month' and month !=null and month !=''">
			and month(s.saleDate)=#{month} and
			year(s.saleDate)=year(now())
		</if>
		<if
			test="type!=null and type!='' and type=='season' and season !=null and season !='' ">
			and QUARTER(s.saleDate)=#{season} and
			year(s.saleDate)=year(now())
		</if>
		<if
			test="type!=null and type!='' and type=='year' and year !=null and year !='' ">
			and year(s.saleDate)=#{year}
		</if>
		<if
			test="type!=null and type!='' and type=='diy' and start !=null and start !='' ">
			and s.saleDate &gt;=#{start}
		</if>
		<if
			test="type!=null and type!='' and type=='diy'  and end !=null and end !=''">
			and s.saleDate &lt;=#{end}
		</if>

		) taiCount
		FROM
		base_regulatory_object obj
		LEFT JOIN base_regulatory_business b ON obj.id = b.reg_id
		WHERE obj.delete_flag = 0	AND obj.checked = 1
		AND obj.id IN (
			SELECT 	id FROM	base_regulatory_object	WHERE
			delete_flag = 0
			AND reg_type =#{regTypeId}
			AND management_type=0
			AND depart_id IN (
			SELECT id FROM t_s_depart WHERE delete_flag = 0 AND
			<!--  FIND_IN_SET(id, getChildDepartLst(#{did})) -->
			depart_code LIKE CONCAT(#{departCode}, '%')
			))) t GROUP BY t.id ORDER BY	yiwanc DESC,	allCount DESC 
	</select>
	<select id="loadRegReport2" resultMap="BaseResultMapModel"
		parameterType="Object">
		SELECT obj.id,obj.reg_name, 
			(SELECT COUNT(1) FROM base_ledger_sale s WHERE 	s.regId = obj.id AND s.delete_flag = 0
		<if
			test="type!=null and type!='' and type=='month' and month !=null and month !=''">
			and month(s.saleDate)=#{month} and
			year(s.saleDate)=year(now())
		</if>
		<if
			test="type!=null and type!='' and type=='season' and season !=null and season !='' ">
			and QUARTER(s.saleDate)=#{season} and
			year(s.saleDate)=year(now())
		</if>
		<if
			test="type!=null and type!='' and type=='year' and year !=null and year !='' ">
			and year(s.saleDate)=#{year}
		</if>
		<if
			test="type!=null and type!='' and type=='diy' and start !=null and start !='' ">
			and s.saleDate &gt;=#{start}
		</if>
		<if
			test="type!=null and type!='' and type=='diy'  and end !=null and end !=''">
			and s.saleDate &lt;=#{end}
		</if>

		) yiwanc
		FROM
		base_regulatory_object obj
		WHERE obj.delete_flag = 0	AND obj.checked = 1
		AND obj.id IN (
			SELECT 	id FROM	base_regulatory_object	WHERE
			delete_flag = 0
			AND reg_type =#{regTypeId}
			AND depart_id IN (
			SELECT id FROM t_s_depart WHERE delete_flag = 0 AND
			<!--  FIND_IN_SET(id, getChildDepartLst(#{did})) -->
			depart_code LIKE CONCAT(#{departCode}, '%')
			))  ORDER BY yiwanc DESC 
	</select>
	
<!-- 	<delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
		WARNING - @mbg.generated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Tue May 08 
			13:11:49 CST 2018.
		delete from base_ledger_sale
		where id = #{id,jdbcType=INTEGER}
	</delete> -->
	<insert id="insert" parameterType="com.dayuan.bean.ledger.BaseLedgerSale">
		<!-- WARNING - @mbg.generated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Tue May 08 
			13:11:49 CST 2018. -->
		insert into base_ledger_sale (id, businessName, businessId,
		regName, regId, foodName,
		saleDate, size, saleCount,
		customerId, cusRegName, cusPhone,
		cusName, cusCode, customer,
		memo, delete_flag, create_by,
		create_date, update_by, update_date,
		param1, param2, param3
		)
		values (#{id,jdbcType=INTEGER}, #{businessName,jdbcType=VARCHAR},
		#{businessId,jdbcType=INTEGER},
		#{regName,jdbcType=VARCHAR}, #{regId,jdbcType=INTEGER}, #{foodName,jdbcType=VARCHAR},
		#{saleDate,jdbcType=TIMESTAMP}, #{size,jdbcType=VARCHAR},
		#{saleCount,jdbcType=VARCHAR},
		#{customerId,jdbcType=VARCHAR}, #{cusRegName,jdbcType=VARCHAR}, #{cusPhone,jdbcType=VARCHAR},
		#{cusName,jdbcType=VARCHAR}, #{cusCode,jdbcType=VARCHAR},
		#{customer,jdbcType=VARCHAR},
		#{memo,jdbcType=VARCHAR}, #{delete_flag,jdbcType=SMALLINT}, #{create_by,jdbcType=VARCHAR},
		#{create_date,jdbcType=TIMESTAMP}, #{update_by,jdbcType=VARCHAR},
		#{update_date,jdbcType=TIMESTAMP},
		#{param1,jdbcType=VARCHAR}, #{param2,jdbcType=VARCHAR}, #{param3,jdbcType=VARCHAR}
		)
	</insert>
	<insert id="insertSelective" parameterType="com.dayuan.bean.ledger.BaseLedgerSale">
		<!-- WARNING - @mbg.generated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Tue May 08 
			13:11:49 CST 2018. -->
		insert into base_ledger_sale
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="id != null">
				id,
			</if>
			<if test="businessName != null">
				businessName,
			</if>
			<if test="businessId != null">
				businessId,
			</if>
			<if test="regName != null">
				regName,
			</if>
			<if test="regId != null">
				regId,
			</if>
			<if test="foodName != null">
				foodName,
			</if>
			<if test="saleDate != null">
				saleDate,
			</if>
			<if test="size != null">
				size,
			</if>
			<if test="saleCount != null">
				saleCount,
			</if>
			<if test="customerId != null">
				customerId,
			</if>
			<if test="cusRegName != null">
				cusRegName,
			</if>
			<if test="cusPhone != null">
				cusPhone,
			</if>
			<if test="cusName != null">
				cusName,
			</if>
			<if test="cusCode != null">
				cusCode,
			</if>
			<if test="customer != null">
				customer,
			</if>
			<if test="memo != null">
				memo,
			</if>
			<if test="delete_flag != null">
				delete_flag,
			</if>
			<if test="create_by != null">
				create_by,
			</if>
			<if test="create_date != null">
				create_date,
			</if>
			<if test="update_by != null">
				update_by,
			</if>
			<if test="update_date != null">
				update_date,
			</if>
			<if test="param1 != null">
				param1,
			</if>
			<if test="param2 != null">
				param2,
			</if>
			<if test="param3 != null">
				param3,
			</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="id != null">
				#{id,jdbcType=INTEGER},
			</if>
			<if test="businessName != null">
				#{businessName,jdbcType=VARCHAR},
			</if>
			<if test="businessId != null">
				#{businessId,jdbcType=INTEGER},
			</if>
			<if test="regName != null">
				#{regName,jdbcType=VARCHAR},
			</if>
			<if test="regId != null">
				#{regId,jdbcType=INTEGER},
			</if>
			<if test="foodName != null">
				#{foodName,jdbcType=VARCHAR},
			</if>
			<if test="saleDate != null">
				#{saleDate,jdbcType=TIMESTAMP},
			</if>
			<if test="size != null">
				#{size,jdbcType=VARCHAR},
			</if>
			<if test="saleCount != null">
				#{saleCount,jdbcType=VARCHAR},
			</if>
			<if test="customerId != null">
				#{customerId,jdbcType=VARCHAR},
			</if>
			<if test="cusRegName != null">
				#{cusRegName,jdbcType=VARCHAR},
			</if>
			<if test="cusPhone != null">
				#{cusPhone,jdbcType=VARCHAR},
			</if>
			<if test="cusName != null">
				#{cusName,jdbcType=VARCHAR},
			</if>
			<if test="cusCode != null">
				#{cusCode,jdbcType=VARCHAR},
			</if>
			<if test="customer != null">
				#{customer,jdbcType=VARCHAR},
			</if>
			<if test="memo != null">
				#{memo,jdbcType=VARCHAR},
			</if>
			<if test="delete_flag != null">
				#{delete_flag,jdbcType=SMALLINT},
			</if>
			<if test="create_by != null">
				#{create_by,jdbcType=VARCHAR},
			</if>
			<if test="create_date != null">
				#{create_date,jdbcType=TIMESTAMP},
			</if>
			<if test="update_by != null">
				#{update_by,jdbcType=VARCHAR},
			</if>
			<if test="update_date != null">
				#{update_date,jdbcType=TIMESTAMP},
			</if>
			<if test="param1 != null">
				#{param1,jdbcType=VARCHAR},
			</if>
			<if test="param2 != null">
				#{param2,jdbcType=VARCHAR},
			</if>
			<if test="param3 != null">
				#{param3,jdbcType=VARCHAR},
			</if>
		</trim>
	</insert>
	<update id="updateByPrimaryKeySelective" parameterType="com.dayuan.bean.ledger.BaseLedgerSale">
		<!-- WARNING - @mbg.generated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Tue May 08 
			13:11:49 CST 2018. -->
		update base_ledger_sale
		<set>
			<if test="businessName != null">
				businessName = #{businessName,jdbcType=VARCHAR},
			</if>
			<if test="businessId != null">
				businessId = #{businessId,jdbcType=INTEGER},
			</if>
			<if test="regName != null">
				regName = #{regName,jdbcType=VARCHAR},
			</if>
			<if test="regId != null">
				regId = #{regId,jdbcType=INTEGER},
			</if>
			<if test="foodName != null">
				foodName = #{foodName,jdbcType=VARCHAR},
			</if>
			<if test="saleDate != null">
				saleDate = #{saleDate,jdbcType=TIMESTAMP},
			</if>
			<if test="size != null">
				size = #{size,jdbcType=VARCHAR},
			</if>
			<if test="saleCount != null">
				saleCount = #{saleCount,jdbcType=VARCHAR},
			</if>
			<if test="customerId != null">
				customerId = #{customerId,jdbcType=VARCHAR},
			</if>
			<if test="cusRegName != null">
				cusRegName = #{cusRegName,jdbcType=VARCHAR},
			</if>
			<if test="cusPhone != null">
				cusPhone = #{cusPhone,jdbcType=VARCHAR},
			</if>
			<if test="cusName != null">
				cusName = #{cusName,jdbcType=VARCHAR},
			</if>
			<if test="cusCode != null">
				cusCode = #{cusCode,jdbcType=VARCHAR},
			</if>
			<if test="customer != null">
				customer = #{customer,jdbcType=VARCHAR},
			</if>
			<if test="memo != null">
				memo = #{memo,jdbcType=VARCHAR},
			</if>
			<if test="delete_flag != null">
				delete_flag = #{delete_flag,jdbcType=SMALLINT},
			</if>
			<if test="create_by != null">
				create_by = #{create_by,jdbcType=VARCHAR},
			</if>
			<if test="create_date != null">
				create_date = #{create_date,jdbcType=TIMESTAMP},
			</if>
			<if test="update_by != null">
				update_by = #{update_by,jdbcType=VARCHAR},
			</if>
			<if test="update_date != null">
				update_date = #{update_date,jdbcType=TIMESTAMP},
			</if>
			<if test="param1 != null">
				param1 = #{param1,jdbcType=VARCHAR},
			</if>
			<if test="param2 != null">
				param2 = #{param2,jdbcType=VARCHAR},
			</if>
			<if test="param3 != null">
				param3 = #{param3,jdbcType=VARCHAR},
			</if>
		</set>
		where id = #{id,jdbcType=INTEGER}
	</update>
	<update id="updateByPrimaryKey" parameterType="com.dayuan.bean.ledger.BaseLedgerSale">
		<!-- WARNING - @mbg.generated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Tue May 08 
			13:11:49 CST 2018. -->
		update base_ledger_sale
		set businessName = #{businessName,jdbcType=VARCHAR},
		businessId = #{businessId,jdbcType=INTEGER},
		regName = #{regName,jdbcType=VARCHAR},
		regId = #{regId,jdbcType=INTEGER},
		foodName = #{foodName,jdbcType=VARCHAR},
		saleDate = #{saleDate,jdbcType=TIMESTAMP},
		size = #{size,jdbcType=VARCHAR},
		saleCount = #{saleCount,jdbcType=VARCHAR},
		customerId = #{customerId,jdbcType=VARCHAR},
		cusRegName = #{cusRegName,jdbcType=VARCHAR},
		cusPhone = #{cusPhone,jdbcType=VARCHAR},
		cusName = #{cusName,jdbcType=VARCHAR},
		cusCode = #{cusCode,jdbcType=VARCHAR},
		customer = #{customer,jdbcType=VARCHAR},
		memo = #{memo,jdbcType=VARCHAR},
		delete_flag = #{delete_flag,jdbcType=SMALLINT},
		create_by = #{create_by,jdbcType=VARCHAR},
		create_date = #{create_date,jdbcType=TIMESTAMP},
		update_by = #{update_by,jdbcType=VARCHAR},
		update_date = #{update_date,jdbcType=TIMESTAMP},
		param1 = #{param1,jdbcType=VARCHAR},
		param2 = #{param2,jdbcType=VARCHAR},
		param3 = #{param3,jdbcType=VARCHAR}
		where id = #{id,jdbcType=INTEGER}
	</update>
	
	<!-- /**
	 * 端州微信-销售台账统计
	 * @param regIds 市场IDs
	 * @param start
	 * @param end
	 * @return
	 * @author LuoYX
	 * @date 2018年6月28日
	 */
	 List<Map<String, Object>> queryStockByRegIds(@Param("regIds")List<Integer> regIds,@Param("start") String start, @Param("end")String end);
	-->
	<select id="queryStockByRegIds" resultType="java.util.Map" parameterType="Object">
		SELECT o.id,o.reg_name,COUNT(b.delete_flag=0 OR NULL) bCount,
		(
			SELECT COUNT(DISTINCT businessId) FROM base_ledger_sale
			WHERE regId =o.id AND saleDate&gt;=#{start} AND saleDate&lt;=#{end}
		) saleCount
		FROM base_regulatory_object o
		LEFT JOIN base_regulatory_business b ON o.id=b.reg_id
		WHERE o.delete_flag=0
		AND o.reg_type in ('4028935f5e7e898a015e7e89a9490001')
		AND management_type=0
		AND o.id in 
		<if test="regIds != null and regIds.size() > 0">
			<foreach item="item" index="index" collection="regIds" open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<if test="regIds == null or regIds.size() == 0">
			(0)
		</if>
		GROUP BY o.id
		ORDER BY saleCount DESC,bCount desc
	</select>
	
	<!-- /**
	 * 查询市场销售台账详情
	 * @param regId
	 * @param start
	 * @param end
	 * @return
	 * @author LuoYX
	 * @date 2018年6月29日
	 */
	List<Map<String, Object>> queryByRegId(@Param("regId")Integer regId,@Param("start") String start,@Param("end") String end); 
	-->
	<select id="queryByRegId" parameterType="Object" resultType="java.util.Map">
		SELECT businessId,
		b.ope_shop_name,b.ope_shop_code,foodName,SUM(s.saleCount) saleCount
		FROM base_ledger_sale s
		LEFT JOIN base_regulatory_business b ON s.businessId=b.id
		WHERE s.delete_flag =0 AND b.delete_flag=0 AND regId=#{regId}
		AND s.saleDate&gt;=#{start} AND s.saleDate&lt;=#{end}
		GROUP BY businessId
	</select>
</mapper>