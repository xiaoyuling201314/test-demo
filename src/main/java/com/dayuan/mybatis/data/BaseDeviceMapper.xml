<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.dayuan.mapper.data.BaseDeviceMapper" >
  <resultMap id="BaseResultMap" type="com.dayuan.bean.data.BaseDevice" >
    <id property="id" column="id" />
    <result property="deviceCode" column="device_code" />
    <result property="deviceName" column="device_name" />
    <result property="deviceStyle" column="device_style" />
    <result property="deviceTypeId" column="device_type_id" />
    <result property="baseUserId" column="base_user_id" />
    <result property="useDate" column="use_date" />
    <result property="month" column="month" />
    <result property="warrantyPeriod" column="warranty_period" />
    <result property="sorting" column="sorting" />
    <result property="description" column="description" />
    <result property="status" column="status" />
    <result property="remark" column="remark" />
    <result property="macAddress" column="mac_address" />
    <result property="serialNumber" column="serial_number" />
    <result property="deleteFlag" column="delete_flag" />
    <result property="createBy" column="create_by" />
    <result property="createDate" column="create_date" />
    <result property="updateBy" column="update_by" />
    <result property="updateDate" column="update_date" />
    <result property="brand" column="brand" />
    <result property="departId" column="depart_id" />
    <result property="pointId" column="point_id" />
    <result property="yunId" column="yun_id" />
    <result property="registerDate" column="register_date" />
    <result property="uploadNumbers" column="upload_numbers" />
    <result property="lastUploadDate" column="last_upload_date" />
    <result property="unbindingDate" column="unbinding_date" />
  </resultMap>
  <sql id="Base_Column_List" >
    id,device_code,device_name,device_style,device_type_id,base_user_id,
    use_date,month,warranty_period,sorting,description,
    status,remark,mac_address,serial_number,delete_flag,
    create_by,create_date,update_by,update_date,brand,
    depart_id,point_id,yun_id,register_date,upload_numbers,
    last_upload_date,unbinding_date
  </sql>
  <!-- 查询条件 -->
	<sql id="Example_Where_Clause">
		where delete_flag = 0 
		<trim suffixOverrides=",">
		<if test="obj.baseBean != null">
			<if test="obj.baseBean.deviceName != null and obj.baseBean.deviceName != ''">
				and device_name like CONCAT('%', #{obj.baseBean.deviceName}, '%')
			</if>
		</if>
		<if test="obj.flag == 1">
				and point_id =#{obj.baseBean.pointId}
		</if>
		<if test="obj.flag == 2">
				and depart_id =#{obj.baseBean.pointId}
		</if>
		</trim>
	</sql>
<!--  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.String" >-->
<!--    select -->
<!--    <include refid="Base_Column_List" />-->
<!--    from base_device-->
<!--    where id = #{id,jdbcType=VARCHAR}-->
<!--  </select>-->
<!--  <update id="deleteByPrimaryKey" parameterType="java.lang.String" >-->
<!--	update base_device bd, base_device_point_rel bdpr -->
<!--	set bd.depart_id=null,bd.point_id=null,bd.update_date=now(),bd.mac_address='',bd.serial_number='',-->
<!--	bdpr.end_date=now(),bdpr.delete_flag=1,bdpr.update_date=now()-->
<!--	where bdpr.device_id=bd.id and bdpr.delete_flag=0 and bd.id in-->
<!--	<foreach collection="array" item="ids" index="index" open="(" close=")" separator=",">-->
<!--		#{ids}-->
<!--	</foreach>-->
<!--  </update>-->
<!--   
  <update id="deleteByPrimaryKey" parameterType="java.lang.String" >
   update base_device set delete_flag=1,update_date=now()
	where id in
	<foreach collection="array" item="ids" index="index" open="(" close=")" separator=",">
		#{ids}
	</foreach>
  </update>
   -->
<!--  <insert id="insert" parameterType="com.dayuan.bean.data.BaseDevice" >-->
<!--    insert into base_device (id, device_code, device_name, -->
<!--      device_style, device_type_id, depart_id, point_id, -->
<!--      base_user_id, use_date, warranty_period, -->
<!--      sorting, description, status, mac_address,serial_number,-->
<!--      remark, delete_flag, create_by, -->
<!--      create_date, update_by, update_date, yun_id, brand,register_date,-->
<!--      upload_numbers,last_upload_date,unbinding_date-->
<!--      )-->
<!--    values (#{id,jdbcType=VARCHAR}, #{deviceCode,jdbcType=VARCHAR}, #{deviceName,jdbcType=VARCHAR}, #{deviceStyle,jdbcType=VARCHAR}, -->
<!--      #{deviceTypeId,jdbcType=VARCHAR}, #{departId,jdbcType=INTEGER}, #{pointId,jdbcType=INTEGER}, -->
<!--      #{baseUserId,jdbcType=VARCHAR}, #{useDate,jdbcType=TIMESTAMP}, #{warrantyPeriod,jdbcType=TIMESTAMP}, -->
<!--      #{sorting,jdbcType=SMALLINT}, #{description,jdbcType=VARCHAR}, #{status,jdbcType=SMALLINT}, -->
<!--      #{macAddress,jdbcType=VARCHAR},#{serialNumber,jdbcType=VARCHAR},#{remark,jdbcType=VARCHAR}, #{deleteFlag,jdbcType=SMALLINT}, #{createBy,jdbcType=VARCHAR}, -->
<!--      #{createDate,jdbcType=TIMESTAMP}, #{updateBy,jdbcType=VARCHAR}, #{updateDate,jdbcType=TIMESTAMP}, #{yunId,jdbcType=INTEGER}, -->
<!--      #{brand,jdbcType=VARCHAR},#{registerDate,jdbcType=TIMESTAMP},#{uploadNumbers,jdbcType=INTEGER},#{lastUploadDate,jdbcType=TIMESTAMP},#{unbindingDate,jdbcType=TIMESTAMP})-->
<!--  </insert>-->
<!--  <insert id="insertSelective" parameterType="com.dayuan.bean.data.BaseDevice" >-->
<!--    insert into base_device-->
<!--    <trim prefix="(" suffix=")" suffixOverrides="," >-->
<!--      <if test="id != null" >-->
<!--        id,-->
<!--      </if>-->
<!--      <if test="deviceCode != null" >-->
<!--        device_code,-->
<!--      </if>-->
<!--      <if test="deviceName != null" >-->
<!--        device_name,-->
<!--      </if>-->
<!--      <if test="deviceStyle != null" >-->
<!--	    device_style,-->
<!--      </if>-->
<!--      <if test="deviceTypeId != null" >-->
<!--        device_type_id,-->
<!--      </if>-->
<!--      <if test="departId != null" >-->
<!--        depart_id,-->
<!--      </if>-->
<!--      <if test="pointId != null" >-->
<!--        point_id,-->
<!--      </if>-->
<!--      <if test="baseUserId != null" >-->
<!--        base_user_id,-->
<!--      </if>-->
<!--      <if test="useDate != null" >-->
<!--        use_date,-->
<!--      </if>-->
<!--      <if test="warrantyPeriod != null" >-->
<!--        warranty_period,-->
<!--      </if>-->
<!--      <if test="sorting != null" >-->
<!--        sorting,-->
<!--      </if>-->
<!--      <if test="description != null" >-->
<!--        description,-->
<!--      </if>-->
<!--      <if test="status != null" >-->
<!--        status,-->
<!--      </if>-->
<!--      <if test="macAddress != null" >-->
<!--        mac_address,-->
<!--      </if>-->
<!--       <if test="serialNumber != null" >-->
<!--        serial_number,-->
<!--      </if>-->
<!--       <if test="remark != null" >-->
<!--        remark,-->
<!--      </if>-->
<!--      <if test="deleteFlag != null" >-->
<!--        delete_flag,-->
<!--      </if>-->
<!--      <if test="createBy != null" >-->
<!--        create_by,-->
<!--      </if>-->
<!--      <if test="createDate != null" >-->
<!--        create_date,-->
<!--      </if>-->
<!--      <if test="updateBy != null" >-->
<!--        update_by,-->
<!--      </if>-->
<!--      <if test="updateDate != null" >-->
<!--        update_date,-->
<!--      </if>-->
<!--      <if test="yunId != null" >-->
<!--        yun_id,-->
<!--      </if>-->
<!--      <if test="brand != null" >-->
<!--        brand,-->
<!--      </if>-->
<!--      <if test="registerDate != null" >-->
<!--        register_date,-->
<!--      </if>-->
<!--      <if test="uploadNumbers != null" >-->
<!--        upload_numbers,-->
<!--      </if>-->
<!--      <if test="lastUploadDate != null" >-->
<!--        last_upload_date,-->
<!--      </if>-->
<!--      <if test="unbindingDate != null" >-->
<!--        unbinding_date,-->
<!--      </if>-->
<!--    </trim>-->
<!--    <trim prefix="values (" suffix=")" suffixOverrides="," >-->
<!--      <if test="id != null" >-->
<!--        #{id,jdbcType=VARCHAR},-->
<!--      </if>-->
<!--      <if test="deviceCode != null" >-->
<!--        #{deviceCode,jdbcType=VARCHAR},-->
<!--      </if>-->
<!--      <if test="deviceName != null" >-->
<!--        #{deviceName,jdbcType=VARCHAR},-->
<!--      </if>-->
<!--      <if test="deviceStyle != null" >-->
<!--        #{deviceStyle,jdbcType=VARCHAR},-->
<!--      </if>-->
<!--      <if test="deviceTypeId != null" >-->
<!--        #{deviceTypeId,jdbcType=VARCHAR},-->
<!--      </if>-->
<!--      <if test="departId != null" >-->
<!--        #{departId,jdbcType=INTEGER},-->
<!--      </if>-->
<!--      <if test="pointId != null" >-->
<!--        #{pointId,jdbcType=INTEGER},-->
<!--      </if>-->
<!--      <if test="baseUserId != null" >-->
<!--        #{baseUserId,jdbcType=VARCHAR},-->
<!--      </if>-->
<!--      <if test="useDate != null" >-->
<!--        #{useDate,jdbcType=TIMESTAMP},-->
<!--      </if>-->
<!--      <if test="warrantyPeriod != null" >-->
<!--        #{warrantyPeriod,jdbcType=TIMESTAMP},-->
<!--      </if>-->
<!--      <if test="sorting != null" >-->
<!--        #{sorting,jdbcType=SMALLINT},-->
<!--      </if>-->
<!--      <if test="description != null" >-->
<!--        #{description,jdbcType=VARCHAR},-->
<!--      </if>-->
<!--      <if test="status != null" >-->
<!--        #{status,jdbcType=SMALLINT},-->
<!--      </if>-->
<!--      <if test="macAddress != null" >-->
<!--       #{macAddress,jdbcType=VARCHAR},-->
<!--      </if>-->
<!--       <if test="serialNumber != null" >-->
<!--        #{serialNumber,jdbcType=VARCHAR},-->
<!--      </if>-->
<!--      <if test="remark != null" >-->
<!--        #{remark,jdbcType=VARCHAR},-->
<!--      </if>-->
<!--      <if test="deleteFlag != null" >-->
<!--        #{deleteFlag,jdbcType=SMALLINT},-->
<!--      </if>-->
<!--      <if test="createBy != null" >-->
<!--        #{createBy,jdbcType=VARCHAR},-->
<!--      </if>-->
<!--      <if test="createDate != null" >-->
<!--        #{createDate,jdbcType=TIMESTAMP},-->
<!--      </if>-->
<!--      <if test="updateBy != null" >-->
<!--        #{updateBy,jdbcType=VARCHAR},-->
<!--      </if>-->
<!--      <if test="updateDate != null" >-->
<!--        #{updateDate,jdbcType=TIMESTAMP},-->
<!--      </if>-->
<!--      <if test="yunId != null" >-->
<!--        #{yunId,jdbcType=INTEGER},-->
<!--      </if>-->
<!--      <if test="brand != null" >-->
<!--        #{brand,jdbcType=VARCHAR},-->
<!--      </if>-->
<!--      <if test="registerDate != null" >-->
<!--        #{registerDate,jdbcType=TIMESTAMP},-->
<!--      </if>-->
<!--      <if test="uploadNumbers != null" >-->
<!--        #{uploadNumbers,jdbcType=INTEGER},-->
<!--      </if>-->
<!--      <if test="lastUploadDate != null" >-->
<!--        #{lastUploadDate,jdbcType=TIMESTAMP},-->
<!--      </if>-->
<!--      <if test="unbindingDate != null" >-->
<!--        #{unbindingDate,jdbcType=TIMESTAMP},-->
<!--      </if>-->
<!--    </trim>-->
<!--  </insert>-->
<!--  <update id="updateByPrimaryKeySelective" parameterType="com.dayuan.bean.data.BaseDevice" >-->
<!--    update base_device-->
<!--    <set >-->
<!--      <if test="deviceCode != null" >-->
<!--        device_code = #{deviceCode,jdbcType=VARCHAR},-->
<!--      </if>-->
<!--      <if test="deviceName != null" >-->
<!--        device_name = #{deviceName,jdbcType=VARCHAR},-->
<!--      </if>-->
<!--      <if test="deviceStyle != null" >-->
<!--        device_style = #{deviceStyle,jdbcType=VARCHAR},-->
<!--      </if>-->
<!--      <if test="deviceTypeId != null" >-->
<!--        device_type_id = #{deviceTypeId,jdbcType=VARCHAR},-->
<!--      </if>-->
<!--      <if test="departId != null" >-->
<!--        depart_id = #{departId,jdbcType=INTEGER},-->
<!--      </if>-->
<!--      <if test="pointId != null" >-->
<!--        point_id = #{pointId,jdbcType=INTEGER},-->
<!--      </if>-->
<!--      <if test="baseUserId != null" >-->
<!--        base_user_id = #{baseUserId,jdbcType=VARCHAR},-->
<!--      </if>-->
<!--      <if test="useDate != null" >-->
<!--        use_date = #{useDate,jdbcType=TIMESTAMP},-->
<!--      </if>-->
<!--      <if test="warrantyPeriod != null" >-->
<!--        warranty_period = #{warrantyPeriod,jdbcType=TIMESTAMP},-->
<!--      </if>-->
<!--      <if test="sorting != null" >-->
<!--        sorting = #{sorting,jdbcType=SMALLINT},-->
<!--      </if>-->
<!--      <if test="description != null" >-->
<!--        description = #{description,jdbcType=VARCHAR},-->
<!--      </if>-->
<!--      <if test="status != null" >-->
<!--        status = #{status,jdbcType=SMALLINT},-->
<!--      </if>-->
<!--        mac_address = #{macAddress,jdbcType=VARCHAR},-->
<!--        serial_number = #{serialNumber,jdbcType=VARCHAR},-->
<!--      <if test="remark != null" >-->
<!--        remark = #{remark,jdbcType=VARCHAR},-->
<!--      </if>-->
<!--      <if test="deleteFlag != null" >-->
<!--        delete_flag = #{deleteFlag,jdbcType=SMALLINT},-->
<!--      </if>-->
<!--      <if test="createBy != null" >-->
<!--        create_by = #{createBy,jdbcType=VARCHAR},-->
<!--      </if>-->
<!--      <if test="createDate != null" >-->
<!--        create_date = #{createDate,jdbcType=TIMESTAMP},-->
<!--      </if>-->
<!--      <if test="updateBy != null" >-->
<!--        update_by = #{updateBy,jdbcType=VARCHAR},-->
<!--      </if>-->
<!--      <if test="updateDate != null" >-->
<!--        update_date = #{updateDate,jdbcType=TIMESTAMP},-->
<!--      </if>-->
<!--        yun_id = #{yunId,jdbcType=INTEGER},-->
<!--      <if test="brand != null" >-->
<!--        brand = #{brand,jdbcType=VARCHAR},-->
<!--      </if>-->
<!--        register_date=#{registerDate,jdbcType=TIMESTAMP},-->
<!--        upload_numbers=#{uploadNumbers,jdbcType=INTEGER},-->
<!--        last_upload_date=#{lastUploadDate,jdbcType=TIMESTAMP},-->
<!--        unbinding_date=#{unbindingDate,jdbcType=TIMESTAMP},-->
<!--    </set>-->
<!--    where id = #{id,jdbcType=VARCHAR}-->
<!--  </update>-->
<!--  <update id="updateByPrimaryKey" parameterType="com.dayuan.bean.data.BaseDevice" >-->
<!--    update base_device-->
<!--    set device_code = #{deviceCode,jdbcType=VARCHAR},-->
<!--      device_name = #{deviceName,jdbcType=VARCHAR},-->
<!--      device_style = #{deviceStyle,jdbcType=VARCHAR},-->
<!--      device_type_id = #{deviceTypeId,jdbcType=VARCHAR},-->
<!--      depart_id = #{departId,jdbcType=INTEGER},-->
<!--      point_id = #{pointId,jdbcType=INTEGER},-->
<!--      base_user_id = #{baseUserId,jdbcType=VARCHAR},-->
<!--      use_date = #{useDate,jdbcType=TIMESTAMP},-->
<!--      warranty_period = #{warrantyPeriod,jdbcType=SMALLINT},-->
<!--      sorting = #{sorting,jdbcType=SMALLINT},-->
<!--      description = #{description,jdbcType=VARCHAR},-->
<!--      status = #{status,jdbcType=SMALLINT},-->
<!--      mac_address = #{macAddress,jdbcType=VARCHAR},-->
<!--	  serial_number = #{serialNumber,jdbcType=VARCHAR},-->
<!--      remark = #{remark,jdbcType=VARCHAR},-->
<!--      delete_flag = #{deleteFlag,jdbcType=SMALLINT},-->
<!--      create_by = #{createBy,jdbcType=VARCHAR},-->
<!--      create_date = #{createDate,jdbcType=TIMESTAMP},-->
<!--      update_by = #{updateBy,jdbcType=VARCHAR},-->
<!--      update_date = #{updateDate,jdbcType=TIMESTAMP},-->
<!--      yun_id = #{yunId,jdbcType=INTEGER},-->
<!--      brand = #{brand,jdbcType=VARCHAR},-->
<!--      register_date=#{registerDate,jdbcType=TIMESTAMP},-->
<!--      upload_numbers=#{uploadNumbers,jdbcType=INTEGER},-->
<!--      last_upload_date=#{lastUploadDate,jdbcType=TIMESTAMP},-->
<!--      unbinding_date=#{unbindingDate,jdbcType=TIMESTAMP}-->
<!--    where id = #{id,jdbcType=VARCHAR}-->
<!--  </update>-->
   <!-- 分页基础查询 -->
  	<select id="loadDatagrid" resultMap="BaseResultMap" parameterType="Object" >
	    select <include refid="Base_Column_List" />
	    from base_device 
    	<include refid="Example_Where_Clause" />
	    order by create_date ${order} limit #{rowOffset}, #{pageSize}
  	</select>
	
 	<select id="getRowTotal" resultType="java.lang.Integer" parameterType="Object" >
    	select count(1) as rowTotal 
    	from base_device 
    	<include refid="Example_Where_Clause" />
  	</select>
  
  <!-- 通过检查点ID、仪器类型，查询检查点注册仪器,
  sortingDate：根据可用状态和仪器注册时间以及更新时间组合排序，如果是新添加的仪器或者解绑的仪器则设置排序时间为当前时间-->
  <select id="queryAllDeviceByPointId" resultMap="BaseResultMap" parameterType="java.lang.String" >
    select
        bd.id, bd.device_code, bd.device_name, bd.device_style, bd.device_type_id, bd.depart_id, bd.point_id, bd.base_user_id,
        bd.use_date, bd.warranty_period, bd.sorting, bd.description, bd.status, bd.remark, bd.mac_address, bd.serial_number,
        bd.delete_flag, bd.create_by, bd.create_date, bd.update_by, bd.update_date, bd.yun_id, bd.brand, bd.register_date,
        IFNULL(bd.register_date,now()) sortingDate,bd.upload_numbers, bd.last_upload_date, bd.unbinding_date,
        (SELECT bdt.device_series FROM base_device_type bdt WHERE bdt.id = bd.device_type_id) deviceSeries
    from base_device bd
    where bd.delete_flag = 0
    <if test="pointId!=null and pointId!=''">
    	and bd.point_id = #{pointId,jdbcType=VARCHAR}
    </if>
    <if test="departId!=null and departId!=''">
    	and bd.depart_id = #{departId}
    </if>
    <if test="deviceStyle!=null and deviceStyle!=''">
    	and bd.device_style = #{deviceStyle}
    </if>
    ORDER BY `status` ASC,sortingDate desc,update_date desc
    <!-- ORDER BY `status` ASC,serial_number ASC,register_date desc,update_date desc -->
  </select>
  	
  	<select id="queryByDeviceType" resultType="java.lang.String" parameterType="java.lang.String">
  		select id from base_device  where device_type_id=#{deviceTypeId} and delete_flag=0
  	</select>
  	
	<select id="queryBySerialNumber" resultMap="BaseResultMap" parameterType="java.lang.String">
  		select <include refid="Base_Column_List" />
  		 from base_device  where serial_number=#{id} and delete_flag=0
  	</select>
  	
  	<select id="queryBySeriesAndCode" resultMap="BaseResultMap" parameterType="java.lang.String">
  		select <include refid="Base_Column_List" />
  		 from base_device where device_type_id=#{deviceSeriesId} and device_code=#{deviceCode} and delete_flag=0
  	</select>

  <select id="queryByDeviceCode" resultMap="BaseResultMap" parameterType="java.lang.String">
    select <include refid="Base_Column_List" />
    from base_device  where delete_flag=0 and device_code=#{deviceCode}
  </select>
</mapper>