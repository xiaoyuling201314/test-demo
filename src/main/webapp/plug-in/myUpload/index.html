<!DOCTYPE html>
<html>
<head>
    <title>Title</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <!-- 界面基本样式 -->
    <link rel="stylesheet" type="text/css" href="css/iconfont.css"/>
    <link rel="stylesheet" type="text/css" href="css/misson.css"/>
    <link rel="stylesheet" type="text/css" href="js/easyupload.css"/>
    <!-- javascript -->
    <script type="text/javascript" src="js/jquery.min1.11.3.js"></script>
    <script type="text/javascript" charset="utf-8" src="js/easyupload.js"></script>
</head>
<body>
<form enctype="multipart/form-data" id="saveForm">
    <table class="cs-form-table cs-form-table-he">
        <tbody>
        <tr>
            <td class="cs-name">相关资料：</td>
            <td id="uploader0" colspan="5">
            </td>
            <td >
                <button type="button" data-upload="0" class="tj" >提交</button>
            </td>
        </tr>
        <tr>
            <td class="cs-name">相关资料：</td>
            <td id="uploader1" colspan="5">
            </td>
            <td >
                <button type="button" data-upload="1" class="tj" >提交</button>
            </td>
        </tr>
        <tr>
            <td class="cs-name">相关资料：</td>
            <td id="uploader2" colspan="5">
            </td>
            <td >
                <button type="button" data-upload="2" class="tj" >提交</button>
            </td>
        </tr>
        <tr>
            <td class="cs-name">相关资料：</td>
            <td id="uploader3" colspan="5">
            </td>
            <td >
                <button type="button" data-upload="3" class="tj" >提交</button>
            </td>
        </tr>
        </tbody>
    </table>
</form>
<script>
    var arr = [];//存放uploader对象
    $(function () {
        for (var i = 0; i < 4; i++) {
            var uploadObj = createUploadObj("uploader" + i, "files");
            arr.push(uploadObj);
        }

        function createUploadObj(id, name) {
            var uploaderobj = easyUploader({
                id: id, //容器渲染的ID 必填
                accept: '*',    //可上传的文件类型
                maxCount: 10,   //允许的最大上传数量
                maxSize: 1024,  //允许的文件大小 单位：M
                multiple: true, //是否支持多文件上传
                name: name,     //后台接收的文件名称
                onChange: function (fileList) {
                    //input选中时触发
                    alert('选中文件数量' + fileList.length);
                },
                onAlert: function (msg) {
                    alert(msg);
                    console.log(msg)
                }
            });
            return uploaderobj;
        }

        $(".tj").each(function (index, item) {
            $(item).click(function () {
                console.log(arr);
                var uploader = arr[index];
                //获取formData对象并设置文件参数
                var formData = new FormData($('#saveForm' + index)[0]);
                //把要上传的文件循环添加到formData中
                uploader.files.forEach(function (file, index) {
                    formData.append(uploader.configs.name, file, file.name);
                });
                $.ajax({
                    type: "POST",
                    url: "http://localhost:8080/lxgl/mytest/files",
                    data: formData,
                    contentType: false,
                    processData: false,
                    dataType: "json",
                    success: function (data) {
                        if (data && data.success) {
                            alert('上传成功')
                        } else {
                            alert('上传失败')
                        }
                    }
                });
            });
        });
    });

    /*Controller代码参考
    *
    *
     @RequestMapping("/files")
     @ResponseBody
     public AjaxJson files(@RequestParam(required = false, value = "files") MultipartFile[] files, Short off) {
     AjaxJson jsonObj = new AjaxJson();
     try {
     //保存文件，文件数据库插入数据
     System.out.println(files);
     if (null != off && off == 1) {
     System.out.println("文件需要加密");
     } else {
     System.out.println("文件不需要加密");
     }
     } catch (Exception e) {
     e.printStackTrace();
     jsonObj.setSuccess(false);
     jsonObj.setMsg("操作失败" + e.getMessage());
     }
     return jsonObj;
     }
    *
    *
    *
    *
    * */
</script>
</body>
</html>
